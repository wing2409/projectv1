<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="person">

	<sql id="getPerson">
		SELECT HPB.EMP_CD, HPB.EMP_NM, HPB.EMP_CN_NM, HPB.EMP_EN_NM, HPB.PASSWORD, HPB.RESIDENT_NO, HPB.JOIN_DATE, HOB.ORG_NM
			  , HPB.JOIN_CLASS_CD, HPB.POSITION_CD, HPB.DUTY_CD, HPB.LAST_APPOINT_DATE, HPB.POSITION_UPDATED_DATE, HPB.ORG_CD
			  , HPB.OFFICE_PHONE1, HPB.OFFICE_PHONE2, HPB.OFFICE_PHONE3, HPB.HOME_PHONE1, HPB.HOME_PHONE2, HPB.HOME_PHONE3, HPB.CELL_PHONE1
			  , HPB.JOB_FAMILY_CD, HPB.JOB_CD, HPB.ASSIGNED_TASK, HPB.CELL_PHONE2, HPB.CELL_PHONE3, HPB.EMAIL, HPB.RELIGION_CD
			  , HPB.LAST_SCHOOL_NM, HPB.MAJOR_NM, HPB.SCHOOL_CAREER_CD, HPB.HOUSE_KIND_CD, HPB.IS_VETERAN_WELFARE, HPB.ZIP_CD
			  , HPB.ADDRESS1, HPB.ADDRESS2, HPB.IS_MILITARY_SERVICE, HPB.BIRTH_DATE, HPB.IS_LUNAR, HPB.IS_MARRIAGE, HPB.HOPPY
			  , HPB.TALENT, HPB.RETIRE_REASON, HPB.IMAGE_PATH
			  , CAST(HPB.CREATED_DATE AS VARCHAR(10)) AS CREATED_DATE, CAST(HPB.UPDATED_DATE AS VARCHAR(10)) AS UPDATED_DATE
			  , HPB.UPDATED_ID, HPB.UPDATED_IP
		  FROM HM_PERSON_BASIC HPB
			   INNER JOIN HM_ORGAN_BASIC HOB ON HPB.ORG_CD = HOB.ORG_CD
	</sql>

	<select id="person.getPersonBasic" resultType="HashMap">
		<include refid="person.getPerson" />
		<where> 
			<if test="EMP_CD != null and EMP_CD != ''">
				 AND HPB.EMP_CD = #{EMP_CD}
			</if>
			<if test="EMP_NM != null and EMP_NM != ''">
				 AND HPB.EMP_NM LIKE '%' || #{EMP_NM} || '%'
			</if>
		</where>
	</select>
	
	<select id="person.getLoginInfo" resultType="HashMap">	
		<include refid="person.getPerson" />
		WHERE HPB.EMP_CD = #{EMP_CD}
	</select>
	
	<select id="person.getPersonOrg" resultType="HashMap">	
		SELECT HPB.EMP_CD, HPB.EMP_NM, HPB.ORG_CD, HOB.ORG_NM, HPB.ASSIGNED_TASK
		  FROM HM_PERSON_BASIC HPB
			   INNER JOIN HM_ORGAN_BASIC HOB ON HPB.ORG_CD = HOB.ORG_CD
		<where> 
			<if test="EMP_CD != null and EMP_CD != ''">
				 AND HPB.EMP_CD = #{EMP_CD}
			</if>
			<if test="EMP_NM != null and EMP_NM != ''">
				 AND HPB.EMP_NM LIKE '%' || #{EMP_NM} || '%'
			</if>
			<if test="ORG_CD != null and ORG_CD != ''">
				 AND HPB.ORG_CD = #{ORG_CD}
			</if>
			<if test="ORG_NM != null and ORG_NM != ''">
				 AND HOB.ORG_NM LIKE '%' || #{ORG_NM} || '%'
			</if>
		</where>
	</select>
	
	<insert id="person.insertPersonBasic">
		INSERT INTO HM_PERSON_BASIC(EMP_CD, EMP_NM, EMP_CN_NM, EMP_EN_NM, PASSWORD, RESIDENT_NO, JOIN_DATE, JOIN_CLASS_CD
			  , POSITION_CD, DUTY_CD, LAST_APPOINT_DATE, POSITION_UPDATED_DATE, ORG_CD, JOB_FAMILY_CD, JOB_CD, ASSIGNED_TASK
			  , OFFICE_PHONE1, OFFICE_PHONE2, OFFICE_PHONE3, HOME_PHONE1, HOME_PHONE2, HOME_PHONE3, CELL_PHONE1, CELL_PHONE2
			  , CELL_PHONE3, EMAIL, RELIGION_CD, LAST_SCHOOL_NM, MAJOR_NM, SCHOOL_CAREER_CD, HOUSE_KIND_CD
			  , ZIP_CD, ADDRESS1, ADDRESS2, IS_VETERAN_WELFARE, IS_MILITARY_SERVICE, BIRTH_DATE, IS_LUNAR, IS_MARRIAGE
			  , HOPPY, TALENT, RETIRE_REASON, IMAGE_PATH, CREATED_DATE, UPDATED_DATE, UPDATED_ID, UPDATED_IP)
			 VALUES (?, ?, ?, ?, ?,  ?, ?, ?, ?, ?,  ?, ?, ?, ?, ?,  ?, ?, ?, ?, ?,  ?, ?, ?, ?, ?,
					 ?, ?, ?, ?, ?,  ?, ?, ?, ?, ?,  ?, ?, ?, ?, ?,  ?, ?, ?, ?, ?,  ?, ?)
			 VALUES (#{EMP_CD}, #{EMP_NM}, #{EMP_CN_NM}, #{EMP_EN_NM}, #{PASSWORD}, #{RESIDENT_NO}, #{JOIN_DATE}
				   , #{JOIN_CLASS_CD}, #{POSITION_CD}, #{DUTY_CD}
				   , #{LAST_APPOINT_DATE}, #{POSITION_UPDATED_DATE}
				   , #{ORG_CD}, #{JOB_FAMILY_CD}, #{JOB_CD}, #{ASSIGNED_TASK}
				   , #{OFFICE_PHONE1}, #{OFFICE_PHONE2}, #{OFFICE_PHONE3}, #{HOME_PHONE1}, #{HOME_PHONE2}, #{HOME_PHONE3}, #{CELL_PHONE1}, #{CELL_PHONE2}
				   , #{CELL_PHONE3}, #{EMAIL}, #{RELIGION_CD}, #{LAST_SCHOOL_NM}, #{MAJOR_NM}, #{SCHOOL_CAREER_CD}, #{HOUSE_KIND_CD}
				   , #{ZIP_CD}, #{ADDRESS1}, #{ADDRESS2}, #{IS_VETERAN_WELFARE}, #{IS_MILITARY_SERVICE}, #{BIRTH_DATE}
				   , #{IS_LUNAR}, #{IS_MARRIAGE}, #{HOPPY}, #{TALENT}, #{RETIRE_REASON}, #{IMAGE_PATH}
				   , #{CREATED_DATE}, #{UPDATED_DATE}, #{UPDATED_ID}, #{UPDATED_IP})
	</insert>
	
	<update id="person.updatePersonBasic">
		UPDATE HM_PERSON_BASIC
		   SET EMP_NM = #{EMP_NM}, EMP_CN_NM = #{EMP_CN_NM}, EMP_EN_NM = #{EMP_EN_NM}, PASSWORD = #{PASSWORD}, RESIDENT_NO = #{RESIDENT_NO}
			  , JOIN_DATE = #{JOIN_DATE}, JOIN_CLASS_CD = #{JOIN_CLASS_CD}
			  , POSITION_CD = #{POSITION_CD}, DUTY_CD = #{DUTY_CD}
			  , LAST_APPOINT_DATE = #{LAST_APPOINT_DATE}, POSITION_UPDATED_DATE = #{POSITION_UPDATED_DATE}
			  , ORG_CD = #{ORG_CD}, JOB_FAMILY_CD = #{JOB_FAMILY_CD}
			  , JOB_CD = #{JOB_CD}, ASSIGNED_TASK = #{ASSIGNED_TASK}, OFFICE_PHONE1 = #{OFFICE_PHONE1}, OFFICE_PHONE2 = #{OFFICE_PHONE2}
			  , OFFICE_PHONE3 = #{OFFICE_PHONE3}, HOME_PHONE1 = #{HOME_PHONE1}, HOME_PHONE2 = #{HOME_PHONE2}
			  , HOME_PHONE3 = #{HOME_PHONE3}, CELL_PHONE1 = #{CELL_PHONE1}, CELL_PHONE2 = #{CELL_PHONE2}, CELL_PHONE3 = #{CELL_PHONE3}
			  , EMAIL = #{EMAIL}, RELIGION_CD = #{RELIGION_CD}, LAST_SCHOOL_NM = #{LAST_SCHOOL_NM}
			  , MAJOR_NM = #{MAJOR_NM}, SCHOOL_CAREER_CD = #{SCHOOL_CAREER_CD}, HOUSE_KIND_CD = #{HOUSE_KIND_CD}, ZIP_CD = #{ZIP_CD}
			  , ADDRESS1 = #{ADDRESS1}, ADDRESS2 = #{ADDRESS2}, IS_VETERAN_WELFARE = #{IS_VETERAN_WELFARE}
			  , IS_MILITARY_SERVICE = #{IS_MILITARY_SERVICE}, BIRTH_DATE = #{BIRTH_DATE}, IS_LUNAR = #{IS_LUNAR}
			  , IS_MARRIAGE = #{IS_MARRIAGE}, HOPPY = #{HOPPY}, TALENT = #{TALENT}, RETIRE_REASON = #{RETIRE_REASON}, IMAGE_PATH = #{IMAGE_PATH}
			  , CREATED_DATE = #{CREATED_DATE}, UPDATED_DATE = #{UPDATED_DATE}, UPDATED_ID = #{UPDATED_ID}, UPDATED_IP = #{UPDATED_IP}
		 WHERE EMP_CD = #{EMP_CD}
	</update>
	
	<delete id="person.deletePersonBasic">
		DELETE FROM HM_PERSON_BASIC WHERE EMP_CD = #{EMP_CD}
	</delete>
	
	<select id="person.getPersonFamilyList" resultType="HashMap">	
		SELECT EMP_CD, SEQ, RELATIONSHIP, FAMILY_NM, RESIDENT_NO, JOB, IS_CORESIDENCE, IS_SUPPORT
			 , CAST(CREATED_DATE AS VARCHAR(10)) AS CREATED_DATE, CAST(UPDATED_DATE AS VARCHAR(10)) AS UPDATED_DATE
			 , UPDATED_ID, UPDATED_IP
		  FROM HM_PERSON_FAMILY
		<where> 
			<if test="EMP_CD != null and EMP_CD != ''">
				 AND EMP_CD = #{EMP_CD}
			</if>
		</where>
	</select>
	
	<select id="person.getPersonFamilyMaxSeq" resultType="int">	
		SELECT CASE WHEN (COUNT(*) > 0) THEN MAX(SEQ) ELSE 0 END AS MAX_SEQ
		  FROM HM_PERSON_FAMILY   
		<where> 
			<if test="EMP_CD != null and EMP_CD != ''">
				 AND EMP_CD = #{EMP_CD}
			</if>
		</where>
	</select>
	
	<insert id="person.insertPersonFamily">
		INSERT INTO HM_PERSON_FAMILY(EMP_CD, SEQ, RELATIONSHIP, FAMILY_NM, RESIDENT_NO, JOB, IS_CORESIDENCE, IS_SUPPORT
				  , CREATED_DATE, UPDATED_DATE, UPDATED_ID, UPDATED_IP)
			 VALUES (#{EMP_CD}, #{SEQ}, #{RELATIONSHIP}, #{FAMILY_NM}, #{RESIDENT_NO}, #{JOB}, #{IS_CORESIDENCE}, #{IS_SUPPORT}
				  , #{CREATED_DATE}, #{UPDATED_DATE}, #{UPDATED_ID}, #{UPDATED_IP})
	</insert>
	
	<update id="person.updatePersonFamily">
		UPDATE HM_PERSON_FAMILY 
		   SET RELATIONSHIP = #{RELATIONSHIP}, FAMILY_NM = #{FAMILY_NM}, RESIDENT_NO = #{RESIDENT_NO}, JOB = #{JOB}, IS_CORESIDENCE = #{IS_CORESIDENCE}, IS_SUPPORT = #{IS_SUPPORT}
			 , UPDATED_DATE = #{UPDATED_DATE}, UPDATED_ID = #{UPDATED_ID}, UPDATED_IP = #{UPDATED_IP}
		 WHERE EMP_CD = #{EMP_CD} AND SEQ = #{SEQ}
	</update>
	
	<delete id="person.deletePersonFamily">
		DELETE FROM HM_PERSON_FAMILY WHERE EMP_CD = #{EMP_CD} AND SEQ = #{SEQ}
	</delete>
	
	<select id="person.getPersonProjectList" resultType="HashMap">	
		SELECT EMP_CD, SEQ, PROJECT_NM, PROJECT_DESC, START_DATE, END_DATE, ASSIGNED_TASK, ORDERING_ORG, COMPANY, NOTE
			 , CAST(CREATED_DATE AS VARCHAR(10)) AS CREATED_DATE, CAST(UPDATED_DATE AS VARCHAR(10)) AS UPDATED_DATE
			 , UPDATED_ID, UPDATED_IP
		  FROM HM_PERSON_PROJECT
		<where> 
			<if test="EMP_CD != null and EMP_CD != ''">
				 AND EMP_CD = #{EMP_CD}
			</if>
		</where>
	</select>
	
	<select id="person.getPersonProjectMaxSeq" resultType="int">	
		SELECT CASE WHEN (COUNT(*) > 0) THEN MAX(SEQ) ELSE 0 END AS MAX_SEQ
		  FROM HM_PERSON_PROJECT
		<where> 
			<if test="EMP_CD != null and EMP_CD != ''">
				 AND EMP_CD = #{EMP_CD}
			</if>
		</where>
	</select>
	
	<insert id="person.insertPersonProject">
		INSERT INTO HM_PERSON_PROJECT(EMP_CD, SEQ, PROJECT_NM, PROJECT_DESC, START_DATE, END_DATE, ASSIGNED_TASK, ORDERING_ORG, COMPANY, NOTE
				  , CREATED_DATE, UPDATED_DATE, UPDATED_ID, UPDATED_IP)
			 VALUES (#{EMP_CD}, #{SEQ}, #{PROJECT_NM}, #{PROJECT_DESC}, #{START_DATE}, #{END_DATE}
				  , #{ASSIGNED_TASK}, #{ORDERING_ORG}, #{COMPANY}, #{NOTE}
				  , #{CREATED_DATE}, #{UPDATED_DATE}, #{UPDATED_ID}, #{UPDATED_IP})
	</insert>
	
	<update id="person.updatePersonProject">
		UPDATE HM_PERSON_PROJECT 
		   SET PROJECT_NM = #{PROJECT_NM}, PROJECT_DESC = #{PROJECT_DESC}
			 , START_DATE = #{START_DATE}, END_DATE = #{END_DATE}
			 , ASSIGNED_TASK = #{ASSIGNED_TASK}, ORDERING_ORG = #{ORDERING_ORG}, COMPANY = #{COMPANY}, NOTE = #{NOTE}
			 , UPDATED_DATE = #{UPDATED_DATE}, UPDATED_ID = #{UPDATED_ID}, UPDATED_IP = #{UPDATED_IP}
		 WHERE EMP_CD = #{EMP_CD} AND SEQ = #{SEQ}
	</update>
	
	<delete id="person.deletePersonProject">
		DELETE FROM HM_PERSON_PROJECT WHERE EMP_CD = #{EMP_CD} AND SEQ = #{SEQ}
	</delete>
	
</mapper>